<div class="bg-zinc-900/50 border border-zinc-800 rounded-lg p-4 h-full overflow-y-auto">
  <%!-- Agent Detail --%>
  <div :if={@agent}>
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-sm font-semibold text-zinc-300">{@agent[:name] || "Agent"}</h3>
      <button
        phx-click="clear_command_selection"
        class="text-xs text-zinc-600 hover:text-zinc-400"
      >
        x
      </button>
    </div>

    <dl class="space-y-2 text-xs mb-4">
      <div :if={@agent[:model]} class="flex justify-between">
        <dt class="text-zinc-500">Model</dt>
        <dd class="text-zinc-300 font-mono">{@agent[:model]}</dd>
      </div>
      <div class="flex justify-between">
        <dt class="text-zinc-500">Status</dt>
        <dd class={"font-medium #{status_text_color(@agent[:status])}"}>
          {to_string(@agent[:status] || :unknown)}
        </dd>
      </div>
      <div :if={@agent[:uptime]} class="flex justify-between">
        <dt class="text-zinc-500">Uptime</dt>
        <dd class="text-zinc-300">{format_duration(@agent[:uptime])}</dd>
      </div>
      <div :if={@agent[:event_count]} class="flex justify-between">
        <dt class="text-zinc-500">Events</dt>
        <dd class="text-zinc-300">{@agent[:event_count]}</dd>
      </div>
      <div :if={@agent[:cwd]} class="flex justify-between">
        <dt class="text-zinc-500">cwd</dt>
        <dd class="text-zinc-300 font-mono truncate max-w-40" title={@agent[:cwd]}>
          {Path.basename(@agent[:cwd])}
        </dd>
      </div>
    </dl>

    <%!-- Agent actions --%>
    <div class="flex flex-wrap gap-1.5 mb-4">
      <button
        phx-click="pause_agent"
        phx-value-session_id={@agent[:agent_id]}
        class="px-2 py-1 bg-zinc-700 text-zinc-300 rounded text-xs hover:bg-zinc-600 transition"
      >
        Pause
      </button>
      <button
        phx-click="resume_agent"
        phx-value-session_id={@agent[:agent_id]}
        class="px-2 py-1 bg-zinc-700 text-zinc-300 rounded text-xs hover:bg-zinc-600 transition"
      >
        Resume
      </button>
      <button
        phx-click="shutdown_agent"
        phx-value-session_id={@agent[:agent_id]}
        class="px-2 py-1 bg-red-600/20 text-red-400 rounded text-xs hover:bg-red-600/30 transition"
        data-confirm="Shut down this agent?"
      >
        Shutdown
      </button>
    </div>

    <%!-- Message form --%>
    <div class="border-t border-zinc-800 pt-3">
      <div class="text-[10px] text-zinc-600 mb-1">
        To: <span class="text-zinc-400 font-mono">{@agent[:name] || @agent[:agent_id]}</span>
        <span class="text-zinc-700 ml-1">({String.slice(to_string(@agent[:agent_id]), 0, 8)})</span>
      </div>
      <form phx-submit="send_command_message" class="flex gap-2">
        <input type="hidden" name="to" value={@agent[:agent_id]} />
        <div id={"cmd-msg-#{@agent[:agent_id]}"} phx-update="ignore" class="flex-1">
          <input
            type="text"
            name="content"
            placeholder={"Message #{@agent[:name] || "agent"}..."}
            class="w-full bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-xs text-zinc-300 placeholder-zinc-600 focus:border-indigo-500 focus:ring-0 focus:outline-none"
          />
        </div>
        <button
          type="submit"
          class="px-2 py-1 bg-indigo-600/20 text-indigo-400 rounded text-xs hover:bg-indigo-600/30 transition"
        >
          Send
        </button>
      </form>
    </div>
  </div>

  <%!-- Task Detail (when no agent selected but task is) --%>
  <div :if={!@agent && @task}>
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-sm font-semibold text-zinc-300">Task #{@task.id}</h3>
      <button
        phx-click="clear_command_selection"
        class="text-xs text-zinc-600 hover:text-zinc-400"
      >
        x
      </button>
    </div>
    <p class="text-xs text-zinc-300 mb-3">{@task.subject}</p>
    <dl class="space-y-2 text-xs">
      <div class="flex justify-between">
        <dt class="text-zinc-500">Status</dt>
        <dd class={"font-medium #{task_status_color(@task.status)}"}>{@task.status}</dd>
      </div>
      <div :if={@task.owner != ""} class="flex justify-between">
        <dt class="text-zinc-500">Owner</dt>
        <dd class="text-zinc-300">{@task.owner}</dd>
      </div>
      <div :if={@task.priority} class="flex justify-between">
        <dt class="text-zinc-500">Priority</dt>
        <dd class="text-zinc-300">{@task.priority}</dd>
      </div>
    </dl>
    <div :if={@task.files != []} class="mt-3">
      <span class="text-xs text-zinc-500">Files:</span>
      <div class="mt-1 space-y-0.5">
        <div :for={f <- @task.files} class="text-[10px] font-mono text-zinc-400 truncate">
          {f}
        </div>
      </div>
    </div>
    <div class="flex gap-1.5 mt-4">
      <button
        phx-click="heal_task"
        phx-value-id={@task.id}
        class="px-2 py-1 bg-amber-600/20 text-amber-400 rounded text-xs hover:bg-amber-600/30 transition"
      >
        Reset to Pending
      </button>
    </div>
  </div>
</div>
