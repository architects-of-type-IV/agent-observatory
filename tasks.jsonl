{"id":"1","status":"completed","subject":"Implement CausalDAG ETS Store (Section 3.1)","description":"This section creates the `Observatory.Mesh.CausalDAG` GenServer at `lib/observatory/mesh/causal_dag.ex` and establishes the core ETS data model. It implements the Node struct definition, per-session table creation, missing-field guard, root node detection, the 30-second orphan buffer with its resolution timer, and cycle prevention via ancestor-chain traversal. These four tasks (covering FR-8.1 through FR-8.4) must complete before any DAG query API, TopologyBuilder, or EntropyTracker integration Subtasks: - [ ] 3.1.1.1 Create `lib/observatory/mesh/causal_dag.ex` with `use GenServer`, define `defmodule Observatory.Mesh.CausalDAG`, and add `defmodule Node` inside it with `defstruct trace_id: nil, parent_step_id: nil, agent_id: nil, intent: nil, confidence_score: nil, entropy_score: nil, action_status: nil, timestamp: nil, children: [], orphan: false`; start the GenServer with `start_link/1` and `init/1` that creates an ETS table `:causal_dag_session_registry` with type `:set` to track which session table names exist, then confirm `mix compile --warnings-as-errors` passes `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.1.1.2 Implement `def insert(session_id, %Node{} = node)` as a public function that calls `GenServer.call(__MODULE__, {:insert, session_id, node})`; implement `handle_call({:insert, session_id, node}, _from, state)` that first calls a private `validate_fields/1` — returning `{:reply, {:error, :missing_fields}, state}` if any of the nine required struct fields is nil (excluding `parent_step_id`, which may be nil for roots, and `children` and `orphan`, which have defaults); on validation pass, call `ensure_session_table(session_id)` to create a new ETS table named `:\"dag_#{session_id}\"` with type `:set` if it does not yet exist, registering the name in `:causal_dag_session_registry` `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.1.1.3 Inside `handle_call({:insert, ...})`, after table setup: if `node.parent_step_id == nil`, write the node directly to","goal":"Section 3.1 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix test test/observatory/mesh/causal_dag_test.exs"],"priority":"high","blocked_by":[],"files":["lib/observatory/mesh/causal_dag.ex","test/observatory/mesh/causal_dag_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/mesh/causal_dag_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:18:06Z","tags":["phase-3","causaldag-ets-store","section-3.1"],"roadmap_ref":"3.1","notes":""}
{"id":"2","status":"completed","subject":"Implement DAG Query API & Pruning (Section 3.2)","description":"This section exposes the public read API (`get_session_dag/1`), specifies the delta broadcast format and emission rules, and implements session pruning triggered by `is_terminal` signals. Together these four tasks (covering FR-8.5 through FR-8.8) complete the server-side DAG subsystem. All downstream consumers — `TopologyBuilder`, the Session Drill-down LiveView, and the entropy integration test suite — depend on `get_session_dag/1` and the delta broadcast contract being stable before they c Subtasks: - [ ] 3.2.1.1 Implement `def get_session_dag(session_id)` as a public function that calls `GenServer.call(__MODULE__, {:get_session_dag, session_id})`; implement `handle_call({:get_session_dag, session_id}, _from, state)`: if no entry exists in `:causal_dag_session_registry` for `session_id`, return `{:reply, {:error, :session_not_found}, state}`; otherwise, call `:ets.tab2list(:\"dag_#{session_id}\")` to read all `{trace_id, node}` tuples, convert to a map `%{trace_id => node}`, and return `{:reply, {:ok, node_map}, state}` `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.2.1.2 In `test/observatory/mesh/causal_dag_test.exs`, write a test `\"get_session_dag/1 returns all 12 nodes for a known session\"` that inserts 12 nodes across a chain (root + 11 sequential children), calls `CausalDAG.get_session_dag/1`, and asserts `{:ok, map}` is returned where `map_size(map) == 12` and each value is a `%Node{}` struct; write a second test `\"get_session_dag/1 returns {:error, :session_not_found} for unknown session\"` that calls `get_session_dag(\"sess-unknown\")` on a fresh GenServer and asserts `{:error, :session_not_found}` without raising `done_when: \"mix test test/observatory/mesh/causal_dag_test.exs\"` - [ ] 3.2.2.1 Implement a private `broadcast_delta(session_id, added_nodes, updated_nodes, added_edges)` function in `Observatory.Mesh.CausalDAG` that calls `Phoenix.PubSub.broadcast(Observatory.PubSub, \"session:dag:#{session_id}\", %{event: \"dag_delta\", session_id: session_id, added_n","goal":"Section 3.2 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix test test/observatory/mesh/causal_dag_test.exs"],"priority":"high","blocked_by":["1"],"files":["test/observatory/mesh/causal_dag_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/mesh/causal_dag_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:22:09Z","tags":["phase-3","dag-query-api-pruning","section-3.2"],"roadmap_ref":"3.2","notes":""}
{"id":"3","status":"completed","subject":"Implement Canvas Topology Renderer (JS Hook) (Section 3.3)","description":"This section creates `assets/js/hooks/topology_map.js`, the `Observatory.Gateway.TopologyBuilder` Elixir module, and establishes the `\"gateway:topology\"` PubSub broadcast contract. Together these six tasks cover FR-8.9 through FR-8.13, add the basic zoom/pan controls specified in ADR-016's Phase 1 scope, and complete the full data path from ETS DAG to Canvas pixel. No React or D3 dependency is introduced; the Phase 2 migration trigger (>3 interactive requirements needing >200 lines of custom Can Subtasks: - [ ] 3.3.1.1 Create `assets/js/hooks/topology_map.js` with `const TopologyMap = { mounted() {}, render() {}, handleClick(e) {}, startAnimationLoop() {} }; export default TopologyMap;` and confirm `mix compile --warnings-as-errors` passes (no Elixir changes, but the assets pipeline must not emit warnings); no `import` or `require` statements are permitted in this file `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.3.1.2 Implement `mounted()`: call `this.canvas = this.el.querySelector('canvas')`; if `this.canvas === null`, log `console.error(\"TopologyMap: canvas element not found\")` and return without further initialization; otherwise call `this.ctx = this.canvas.getContext('2d')`, set `this.nodes = []` and `this.edges = []`, call `this.handleEvent(\"topology_update\", ({nodes, edges}) => { this.nodes = nodes; this.edges = edges; })`, add `this.canvas.addEventListener('click', this.handleClick.bind(this))`, and call `this.startAnimationLoop()` `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.3.1.3 Implement `startAnimationLoop()`: assign `this._raf = requestAnimationFrame(() => { this.render(); this.startAnimationLoop(); })`; implement `destroyed()`: call `cancelAnimationFrame(this._raf)` to stop the loop when the LiveView component is removed from the DOM `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.3.1.4 Register `TopologyMap` in `assets/js/app.js` by importing it — `import TopologyMap from \"./hooks/topology_map\"` — and adding it to the Hooks obj","goal":"Section 3.3 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix test test/observatory/gateway/topology_builder_test.exs"],"priority":"high","blocked_by":["1"],"files":["assets/js/app.js","assets/js/hooks/topology_map.js","lib/observatory/gateway/topology_builder.ex","lib/observatory/mesh/causal_dag.ex","test/observatory/gateway/topology_builder_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/gateway/topology_builder_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:33:26Z","tags":["phase-3","canvas-topology-renderer-js-hook","section-3.3"],"roadmap_ref":"3.3","notes":""}
{"id":"4","status":"completed","subject":"Implement EntropyTracker Sliding Window (Section 3.4)","description":"This section creates the `Observatory.Gateway.EntropyTracker` GenServer, establishes its private ETS sliding window data structure, and implements the `record_and_score/2` entry point including window eviction and the uniqueness ratio computation. These tasks cover FR-9.1 through FR-9.3 and must be complete before any severity classification, alerting, or `SchemaInterceptor` integration can be tested in isolation. Subtasks: - [ ] 3.4.1.1 Create `lib/observatory/gateway/entropy_tracker.ex` with `use GenServer`; in `init/1`, create a private ETS table via `:ets.new(:entropy_windows, [:set, :private, {:heir, :none, nil}])` and store the table reference in the GenServer state map as `%{table: table_ref}`; implement `start_link/1` and register the process under the module name `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.4.1.2 Implement the public API: `def record_and_score(session_id, {intent, tool_call, action_status})` calls `GenServer.call(__MODULE__, {:record_and_score, session_id, {intent, tool_call, action_status}})`; the call is synchronous — no `Task.async`, no `cast`; the return type is `{:ok, score, severity}` or `{:error, :missing_agent_id}` `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.4.1.3 In `test/observatory/gateway/entropy_tracker_test.exs` (create this file with `use ExUnit.Case, async: false`), write a test `\"ETS table is private and inaccessible from outside the GenServer process\"` that starts `EntropyTracker` via `start_supervised!`, then in the test process attempts `:ets.lookup(:entropy_windows, \"any-session\")` and asserts it raises `ArgumentError` (ETS `:private` tables reject lookups from non-owner processes) `done_when: \"mix test test/observatory/gateway/entropy_tracker_test.exs\"` - [ ] 3.4.2.1 Implement `handle_call({:record_and_score, session_id, tuple}, _from, %{table: table} = state)`: read the current window from ETS via `:ets.lookup(table, sessi","goal":"Section 3.4 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix test test/observatory/gateway/entropy_tracker_test.exs"],"priority":"high","blocked_by":[],"files":["lib/observatory/gateway/entropy_tracker.ex","test/observatory/gateway/entropy_tracker_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/gateway/entropy_tracker_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:13:47Z","tags":["phase-3","entropytracker-sliding-window","section-3.4"],"roadmap_ref":"3.4","notes":""}
{"id":"5","status":"completed","subject":"Implement Entropy Alerting & Severity (Section 3.5)","description":"This section implements the uniqueness ratio computation and all three severity classification paths — LOOP (score < 0.25), WARNING (0.25 <= score < 0.50), and Normal (score >= 0.50) — along with their associated PubSub broadcasts and the `EntropyAlertEvent` construction and field-validation logic. These tasks cover FR-9.3 through FR-9.7 and must complete before the `SchemaInterceptor` integration in section 3.6 can be tested end-to-end. Subtasks: - [ ] 3.5.1.1 Implement a private `compute_score(window)` function in `EntropyTracker`: `n = length(window)`; if `n == 0` return `1.0` (empty window treated as fully unique — no loop possible); `unique = window |> MapSet.new() |> MapSet.size()`; compute `Float.round(unique / n, 4)` and return the result; this function is called synchronously inside `handle_call({:record_and_score, ...})` after the window has been updated `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.5.1.2 In `test/observatory/gateway/entropy_tracker_test.exs`, write the following unit tests directly against `compute_score` (make it accessible via `@doc false` or by testing via `record_and_score` return values): `\"5 identical tuples yield score 0.2\"` — inserts same tuple 5 times, asserts `{:ok, 0.2, :loop}`; `\"5 unique tuples yield score 1.0\"` — inserts 5 distinct tuples, asserts `{:ok, 1.0, :normal}`; `\"3 tuples with 2 unique yield score 0.6667\"` — inserts 3 tuples where 2 are identical and 1 is distinct, asserts the score field equals `0.6667` `done_when: \"mix test test/observatory/gateway/entropy_tracker_test.exs\"` - [ ] 3.5.2.1 After `compute_score/1` returns inside `handle_call({:record_and_score, session_id, _tuple}, ...)`: read `loop_threshold = Application.get_env(:observatory, :entropy_loop_threshold, 0.25)` — validate it is a number via `is_number/1`; if not a number, log `Logger.warning(\"EntropyTracker: invalid entropy_loop_threshold value #{inspect(loop_threshold)}, using defaul","goal":"Section 3.5 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix test test/observatory/gateway/entropy_tracker_test.exs"],"priority":"high","blocked_by":["4"],"files":["test/observatory/gateway/entropy_tracker_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/gateway/entropy_tracker_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:14:41Z","tags":["phase-3","entropy-alerting-severity","section-3.5"],"roadmap_ref":"3.5","notes":""}
{"id":"6","status":"completed","subject":"Implement Entropy PubSub & SchemaInterceptor Integration (Section 3.6)","description":"This section wires `EntropyTracker` into the `SchemaInterceptor` pipeline established in Phase 2, implements the Gateway-authoritative score overwrite on the `DecisionLog` envelope, configures the Session Cluster Manager LiveView's `\"gateway:entropy_alerts\"` subscription and deduplication logic, and verifies that all three `Application.get_env` configuration reads occur per-call with correct fallback behavior. These tasks cover FR-9.8 through FR-9.11 and represent the final integration seam that Subtasks: - [ ] 3.6.1.1 In `lib/observatory/gateway/schema_interceptor.ex` (created in Phase 2), locate the post-validation routing function (the function that broadcasts a validated `DecisionLog` to downstream subscribers); add a call to `EntropyTracker.record_and_score(session_id, {intent, tool_call, action_status})` synchronously BEFORE the broadcast — not wrapped in `Task.async`, not cast; extract `session_id`, `intent`, `tool_call`, and `action_status` from the validated `%DecisionLog{}` struct using pattern matching on the embedded sub-schemas `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.6.1.2 Pattern-match on the result: on `{:ok, score, _severity}`, call `updated_log = DecisionLog.put_gateway_entropy_score(log, score)` and broadcast `updated_log`; on `{:error, :missing_agent_id}`, log `Logger.warning(\"SchemaInterceptor: entropy computation failed for session #{session_id}, retaining agent-reported score\")`, emit a `SchemaViolationEvent` (or equivalent log structure from Phase 2) noting the failed entropy computation, and broadcast the original `log` with the agent-reported score unchanged `done_when: \"mix compile --warnings-as-errors\"` - [ ] 3.6.1.3 In `test/observatory/gateway/entropy_tracker_test.exs`, write an integration test `\"SchemaInterceptor overwrites cognition.entropy_score with Gateway-computed value\"` that processes a valid `DecisionLog` with `cognition.entropy_score: 0.9` through `SchemaInterceptor`, subscribes the test process to the downstream broadc","goal":"Section 3.6 compiles from scratch matching its FRD exactly","acceptance_criteria":["mix compile --warnings-as-errors","mix compile --warnings-as-errors && mix test test/observatory/mesh/causal_dag_test.exs test/observatory/gateway/entropy_tracker_test.exs test/observatory/gateway/topology_builder_test.exs","mix test test/observatory/gateway/entropy_tracker_test.exs","mix test test/observatory/gateway/schema_interceptor_test.exs"],"priority":"high","blocked_by":["5"],"files":["lib/observatory/gateway/schema_interceptor.ex","test/observatory/gateway/entropy_tracker_test.exs","test/observatory/gateway/schema_interceptor_test.exs"],"done_when":"mix compile --warnings-as-errors && mix test test/observatory/gateway/entropy_tracker_test.exs test/observatory/gateway/schema_interceptor_test.exs","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:26:34Z","tags":["phase-3","entropy-pubsub-schemainterceptor-integration","section-3.6"],"roadmap_ref":"3.6","notes":""}
{"id":"7","status":"completed","subject":"Generate migrations and run full test suite (Phase 3 final)","description":"Final integration task for Phase 3. Generate any pending migrations, apply them, and run the complete test suite with zero failures and zero warnings. Adapt commands to the project build system.","goal":"All Phase 3 changes integrated, full test suite green","acceptance_criteria":["All pending migrations/schema changes applied","Full test suite passes with 0 failures","Build passes with zero warnings"],"priority":"critical","blocked_by":["1","2","3","4","5","6"],"files":[],"done_when":"mix compile --warnings-as-errors && mix test","owner":"lead","created":"2026-02-22T15:07:52Z","updated":"2026-02-22T15:33:51Z","tags":["phase-3","migration","final"],"roadmap_ref":"3.final","notes":"Blocks on ALL other tasks. Run all schema changes and tests in one final pass."}
