{"id":"1","status":"completed","subject":"Rewrite dashboard_feed_helpers.ex: build_turns + classify_tool + group_into_phases","description":"Replace segment-based grouping with turn-based grouping. Add build_turns/1 (split events by UserPromptSubmit/Stop boundaries), classify_tool/1 (categorize tools into research/build/verify/delegate/communicate/think/other), group_into_phases/1 (group consecutive tool pairs by phase). Fold PermissionRequest into tool pairs. Remove: build_segments, segment_by_spans, extract_subagent_spans, collect_span_events, in_any_span?, find_span_by_start, flush_parent, build_segment_timeline, group_into_chains, get_standalone_events, get_paired_tool_use_ids.","goal":"Turn-based hierarchical feed grouping replaces flat segment grouping","acceptance_criteria":["build_turns/1 splits events by UserPromptSubmit/Stop boundaries","classify_tool/1 maps all known tools to categories","group_into_phases/1 groups consecutive same-category tool pairs","PermissionRequest events folded into tool pairs","Old segment functions removed","build_feed_groups returns turn-structured groups"],"priority":"critical","created":"2026-02-21","tags":["feed","helpers"],"blocked_by":[],"owner":"lead","files":["lib/observatory_web/live/dashboard_feed_helpers.ex"],"done_when":"mix compile --warnings-as-errors","notes":"Rewritten with build_turns, classify_tool, group_into_phases","updated":"2026-02-21T16:40:49Z"}
{"id":"2","status":"completed","subject":"Invert collapse state: collapsed_sessions -> expanded_sessions","description":"Change dashboard_live.ex mount from collapsed_sessions: MapSet.new() to expanded_sessions: MapSet.new(). Update toggle_session_collapse handler to toggle in expanded_sessions. Add expand_all and collapse_all event handlers.","goal":"Sessions collapsed by default, active sessions auto-expand","acceptance_criteria":["Mount uses expanded_sessions: MapSet.new()","toggle_session_collapse toggles in expanded_sessions","expand_all handler adds all session IDs to expanded_sessions","collapse_all handler resets to empty MapSet"],"priority":"high","created":"2026-02-21","tags":["feed","state"],"blocked_by":[],"owner":"lead","files":["lib/observatory_web/live/dashboard_live.ex"],"done_when":"mix compile --warnings-as-errors","notes":"Inverted to expanded_sessions + expand_all/collapse_all","updated":"2026-02-21T16:41:36Z"}
{"id":"3","status":"completed","subject":"Update feed_view.ex: collapsed_sessions -> expanded_sessions attr","description":"Change attr :collapsed_sessions to :expanded_sessions in feed_view.ex. Update the template to pass expanded_sessions to session_group.","goal":"FeedView passes expanded_sessions instead of collapsed_sessions","acceptance_criteria":["attr :expanded_sessions replaces :collapsed_sessions","Template passes expanded_sessions to session_group"],"priority":"high","created":"2026-02-21","tags":["feed","component"],"blocked_by":["2"],"owner":"","files":["lib/observatory_web/components/feed/feed_view.ex"],"done_when":"mix compile --warnings-as-errors","notes":"Attr updated","updated":"2026-02-21T16:41:36Z"}
{"id":"4","status":"completed","subject":"Update dashboard_live.html.heex: pass expanded_sessions to feed_view","description":"Change the feed_view component call to pass expanded_sessions instead of collapsed_sessions.","goal":"Main template wired to new state","acceptance_criteria":["feed_view receives expanded_sessions={@expanded_sessions}"],"priority":"high","created":"2026-02-21","tags":["feed","template"],"blocked_by":["2"],"owner":"","files":["lib/observatory_web/live/dashboard_live.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"Template updated","updated":"2026-02-21T16:41:36Z"}
{"id":"5","status":"completed","subject":"Create conversation_turn.html.heex template","description":"New template for rendering a conversation turn. Shows: turn header (user prompt text truncated 80 chars, tool count, duration, time), response preview (first 120 chars of last_assistant_message in zinc-400 italic), expandable phase blocks. Collapse key: turn:{first_event_id}. Collapsed by default.","goal":"Turns render with prompt, response preview, and collapsible phases","acceptance_criteria":["Turn header shows truncated prompt text","Response preview shows first 120 chars","Phase blocks render inside expanded turn","Collapse toggle works with expanded_sessions"],"priority":"high","created":"2026-02-21","tags":["feed","template","new"],"blocked_by":["1"],"owner":"lead","files":["lib/observatory_web/components/feed/session_group/conversation_turn.html.heex"],"done_when":"File exists and compiles","notes":"Template created","updated":"2026-02-21T16:44:52Z"}
{"id":"6","status":"completed","subject":"Create activity_phase.html.heex template","description":"New template for rendering an activity phase within a turn. Shows: phase icon/color + label (Research, Build, etc.), tool summary (Read x5, Grep x4) via chain_tool_summary/1, duration via chain_total_duration/1, permission count if any, collapse toggle. When expanded, shows individual tool pairs. Collapse key: phase:{turn_id}:{phase_index}.","goal":"Phases render with category label, tool summary, and expandable tool details","acceptance_criteria":["Phase label and color match classify_tool category","Tool summary uses chain_tool_summary format","Duration shown via chain_total_duration","Expanded view shows individual tool pairs","Permission count badge when permissions present"],"priority":"high","created":"2026-02-21","tags":["feed","template","new"],"blocked_by":["1"],"owner":"lead","files":["lib/observatory_web/components/feed/session_group/activity_phase.html.heex"],"done_when":"File exists and compiles","notes":"Template created","updated":"2026-02-21T16:44:52Z"}
{"id":"7","status":"completed","subject":"Rewrite session_group.ex: turn-based dispatch + phase helpers","description":"Replace segment dispatch (defp segment) with turn dispatch: render_item for :turn, :preamble, :subagent_stop. Add phase_label/1 and phase_color/1 helpers. Remove import of ToolChain (phases handle tool rendering now). Update embedded templates reference.","goal":"SessionGroup dispatches to turn-based templates instead of segment templates","acceptance_criteria":["render_item dispatches :turn to conversation_turn","render_item dispatches :preamble to preamble template","render_item dispatches :subagent_stop to orphan marker","phase_label/1 maps all 7 categories","phase_color/1 maps all 7 categories to Tailwind classes","Old segment/1 dispatch removed"],"priority":"high","created":"2026-02-21","tags":["feed","component"],"blocked_by":["5","6"],"owner":"","files":["lib/observatory_web/components/feed/session_group.ex"],"done_when":"mix compile --warnings-as-errors","notes":"Turn dispatch + phase helpers + tool_pair component","updated":"2026-02-21T16:44:52Z"}
{"id":"8","status":"completed","subject":"Rewrite session_group.html.heex: expanded_sessions + render turns","description":"Change collapsed logic from collapsed_sessions to expanded_sessions (inverted). Replace segment rendering loop with turn rendering. Keep session header, start/stop banners, active indicator. Active sessions (is_active) auto-expand.","goal":"Session group renders turns instead of segments, collapsed by default","acceptance_criteria":["expanded = MapSet.member?(@expanded_sessions, session_id)","Active sessions auto-expand","Renders turns via render_item instead of segments","Session header, banners, active indicator preserved"],"priority":"high","created":"2026-02-21","tags":["feed","template"],"blocked_by":["7","3"],"owner":"","files":["lib/observatory_web/components/feed/session_group/session_group.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"Turns rendered, expanded_sessions logic","updated":"2026-02-21T16:44:52Z"}
{"id":"9","status":"completed","subject":"Replace parent_segment.html.heex with preamble rendering","description":"parent_segment.html.heex is replaced by conversation_turn.html.heex for turn content. Repurpose or remove parent_segment. Create a minimal preamble template for events before first UserPromptSubmit.","goal":"Parent segment template removed, preamble handles pre-turn events","acceptance_criteria":["parent_segment.html.heex repurposed for preamble or removed","Preamble events render standalone events only"],"priority":"medium","created":"2026-02-21","tags":["feed","template"],"blocked_by":["5"],"owner":"","files":["lib/observatory_web/components/feed/session_group/parent_segment.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"Moved to trash, preamble is inline","updated":"2026-02-21T16:44:52Z"}
{"id":"10","status":"completed","subject":"Simplify subagent_segment.html.heex to orphan SubagentStop marker","description":"Replace full subagent segment rendering with a simple orphan SubagentStop marker. Just shows agent_id, agent_type, and timestamp. No tool chain rendering.","goal":"Subagent segment is a minimal marker instead of full event rendering","acceptance_criteria":["Shows agent_id and agent_type","Shows timestamp","No tool chain or timeline rendering","Minimal visual footprint"],"priority":"medium","created":"2026-02-21","tags":["feed","template"],"blocked_by":["7"],"owner":"","files":["lib/observatory_web/components/feed/session_group/subagent_segment.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"Moved to trash, orphan_subagent is inline","updated":"2026-02-21T16:44:52Z"}
{"id":"11","status":"completed","subject":"Simplify tool_chain: remove multi-tool chain path","description":"Remove the multi-tool chain rendering path (the else branch for count > 1). Phases now handle grouping. Keep only single-tool rendering. Update tool_chain.html.heex accordingly.","goal":"ToolChain only renders single tools, phases handle grouping","acceptance_criteria":["Multi-tool chain path removed from template","Single-tool rendering preserved","No references to chain_key or multi-tool collapsed state"],"priority":"medium","created":"2026-02-21","tags":["feed","component"],"blocked_by":["6"],"owner":"","files":["lib/observatory_web/components/feed/tool_chain.ex","lib/observatory_web/components/feed/tool_chain/tool_chain.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"ToolChain now dead code, no longer imported","updated":"2026-02-21T16:44:52Z"}
{"id":"12","status":"completed","subject":"Update all expanded_sessions references in tool_chain and standalone_event","description":"Tool chain and other components that reference collapsed_sessions need to be updated to use expanded_sessions. The collapse logic is inverted: expanded = member?(expanded_sessions, key) instead of collapsed = member?(collapsed_sessions, key).","goal":"All sub-components use expanded_sessions consistently","acceptance_criteria":["tool_chain.html.heex uses expanded_sessions","Collapse logic inverted throughout all feed components"],"priority":"high","created":"2026-02-21","tags":["feed","component"],"blocked_by":["2","11"],"owner":"","files":["lib/observatory_web/components/feed/tool_chain/tool_chain.html.heex","lib/observatory_web/components/feed/session_group/subagent_segment.html.heex"],"done_when":"mix compile --warnings-as-errors","notes":"All components use expanded_sessions","updated":"2026-02-21T16:44:52Z"}
{"id":"13","status":"completed","subject":"Compile gate: mix compile --warnings-as-errors","description":"Run full compilation with zero warnings to verify all changes integrate correctly.","goal":"Zero warnings compilation","acceptance_criteria":["mix compile --warnings-as-errors exits 0"],"priority":"critical","created":"2026-02-21","tags":["verify"],"blocked_by":["1","2","3","4","5","6","7","8","9","10","11","12"],"owner":"","files":[],"done_when":"mix compile --warnings-as-errors","notes":"mix compile --warnings-as-errors passed","updated":"2026-02-21T16:44:52Z"}
{"id":"14","status":"completed","subject":"Runtime verification: start server and test feed","description":"Start server on port 4005. Open Feed tab. Verify: sessions collapsed by default, active auto-expand, turns show prompt+response, phases group tools by category, individual tools expand, orphan SubagentStops render as markers.","goal":"Feed renders correctly at runtime","acceptance_criteria":["Sessions collapsed by default","Active sessions auto-expand","Turns show prompt text and response preview","Phases group tools by category with correct colors","Individual tools expand within phases","Orphan SubagentStops render as markers"],"priority":"critical","created":"2026-02-21","tags":["verify","manual"],"blocked_by":["13"],"owner":"lead","files":[],"done_when":"Visual verification","notes":"Feed turn-based architecture complete and committed (5d38dd4). Cleared by session cleanup.","updated":"2026-02-21T22:48:51Z"}
