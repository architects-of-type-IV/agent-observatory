---
type: section
id: "4.4"
phase_id: "4"
title: "HITLRelay State Machine"
status: pending
---

# Section 4.4: HITLRelay State Machine

## Purpose

This section creates the `Observatory.Gateway.HITLRelay` GenServer that manages the per-session `Normal` / `Paused` state machine, owns the `:hitl_buffer` ETS table, buffers incoming DecisionLog messages while a session is paused, supports in-buffer rewriting by `meta.trace_id`, and flushes the buffer in arrival order on unpause.

## Tasks

| ID | Title | Governed By | Parent UCs | Status |
|----|-------|-------------|------------|--------|
| 4.4.1 | HITLRelay GenServer and State Machine | ADR-021 | UC-0271, UC-0273 | pending |
| 4.4.2 | ETS Buffer and Rewrite Support | ADR-021 | UC-0272 | pending |
| 4.4.3 | inject Command and Four Command Types | ADR-021 | UC-0274 | pending |
| 4.4.4 | HITLRelay State Machine Tests | ADR-021 | UC-0271, UC-0272, UC-0273, UC-0274 | pending |
