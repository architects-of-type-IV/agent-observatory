---
type: task
id: "3.1.2"
section_id: "3.1"
title: "Orphan Buffer (30-Second Window)"
status: pending
governed_by: ["ADR-017"]
parent_uc: ["UC-0232"]
---

# Task 3.1.2: Orphan Buffer (30-Second Window)

## Goal

When a non-root node arrives whose `parent_step_id` is not yet present in the session ETS table, the node must be placed into an in-memory orphan buffer. If the parent subsequently arrives within 30 seconds, the orphan is promoted. If 30 seconds elapse without the parent arriving, the orphan is attached to the session's first root node with `orphan: true`.

## Governing Decisions

- ADR-017

## Verification UCs

- UC-0232

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 3.1.2.1 | Add :causal_dag_orphan_buffer ETS :bag table in init/1 and schedule check_orphans timer | mix compile --warnings-as-errors | pending |
| 3.1.2.2 | Implement orphan buffer insert when parent absent and check_and_promote_orphans on parent arrival | mix compile --warnings-as-errors | pending |
| 3.1.2.3 | Implement handle_info(:check_orphans) evicting 30s-old orphans to root with orphan: true | mix compile --warnings-as-errors | pending |
| 3.1.2.4 | Write tests for orphan promotion within 30s and forced attachment after timeout | mix test test/observatory/mesh/causal_dag_test.exs | pending |
