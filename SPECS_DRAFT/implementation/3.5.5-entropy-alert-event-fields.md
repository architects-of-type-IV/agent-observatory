---
type: task
id: "3.5.5"
section_id: "3.5"
title: "EntropyAlertEvent Fields"
status: pending
governed_by: ["ADR-018"]
parent_uc: ["UC-0245"]
---

# Task 3.5.5: EntropyAlertEvent Fields

## Goal

Every `EntropyAlertEvent` broadcast to `"gateway:entropy_alerts"` must contain all seven required fields: `event_type`, `session_id`, `agent_id`, `entropy_score`, `window_size`, `repeated_pattern`, and `occurrence_count`. If `agent_id` is not available for the session, the event must not be broadcast and `record_and_score/2` must return `{:error, :missing_agent_id}`.

## Governing Decisions

- ADR-018

## Verification UCs

- UC-0245

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 3.5.5.1 | Extend ETS entry to include agent_id and add register_agent/2 public function | mix compile --warnings-as-errors | pending |
| 3.5.5.2 | Implement build_alert_event/4 with nil agent_id guard, most-frequent pattern computation, and PubSub broadcast | mix compile --warnings-as-errors | pending |
| 3.5.5.3 | Write tests for all 7 required fields in alert event and missing agent_id returning {:error, :missing_agent_id} | mix test test/observatory/gateway/entropy_tracker_test.exs | pending |
