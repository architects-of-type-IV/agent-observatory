---
type: task
id: "5.1.1"
section_id: "5.1"
title: "Six view_mode Atoms, Default Assign, and localStorage Hook"
status: pending
governed_by: ["ADR-022"]
parent_uc: ["UC-0300", "UC-0301", "UC-0303"]
---

# Task 5.1.1: Six view_mode Atoms, Default Assign, and localStorage Hook

## Goal

Define the six valid `view_mode` atoms as a module attribute on `ObservatoryWeb.DashboardLive`, assign `view_mode: :fleet_command` in `mount/3`, and implement the client-side JavaScript hook and server-side `handle_event("restore_view_mode", ...)` handler for localStorage persistence and recovery. The hook must validate the stored string against the valid set. The server-side handler must include a catch-all clause assigning `view_mode: :fleet_command` and emitting a `Logger.warning/1` for unrecognized values.

## Governing Decisions

- ADR-022

## Verification UCs

- UC-0300
- UC-0301
- UC-0303

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 5.1.1.1 | Add @valid_view_modes module attribute and view_mode: :fleet_command assign to mount/3 in dashboard_live.ex | mix compile --warnings-as-errors | pending |
| 5.1.1.2 | Add ViewModePersistence JS hook in app.js reading localStorage and pushing restore_view_mode event | mix compile --warnings-as-errors | pending |
| 5.1.1.3 | Add handle_event("restore_view_mode") with six valid clauses and catch-all warning in dashboard_navigation_handlers.ex | mix compile --warnings-as-errors | pending |
| 5.1.1.4 | Write tests for default :fleet_command, restore scheduler, and legacy "command" falling back to :fleet_command | mix test test/observatory_web/live/dashboard_live_test.exs | pending |
