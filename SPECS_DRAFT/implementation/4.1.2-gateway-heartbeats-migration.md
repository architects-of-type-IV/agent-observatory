---
type: task
id: "4.1.2"
section_id: "4.1"
title: "gateway_heartbeats Migration and Ecto Schema"
status: pending
governed_by: ["ADR-019"]
parent_uc: ["UC-0263"]
---

# Task 4.1.2: gateway_heartbeats Migration and Ecto Schema

## Goal

Create the Ecto migration that establishes the `gateway_heartbeats` table with `agent_id text primary key`, `cluster_id text not null`, `last_seen_at datetime not null`. Define the companion Ecto schema module `Observatory.Gateway.HeartbeatRecord` for performing upserts with `on_conflict: :replace_all, conflict_target: :agent_id`.

## Governing Decisions

- ADR-019

## Verification UCs

- UC-0263

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 4.1.2.1 | Generate and populate Ecto migration creating gateway_heartbeats table | mix ecto.migrate && mix compile --warnings-as-errors | pending |
| 4.1.2.2 | Create heartbeat_record.ex with Ecto.Schema for gateway_heartbeats and changeset/2 | mix compile --warnings-as-errors | pending |
