---
id: UC-0301
title: Navigate Between Views via Keyboard Shortcuts 1-6
status: draft
parent_fr: FR-12.2
adrs: [ADR-022]
---

# UC-0301: Navigate Between Views via Keyboard Shortcuts 1-6

## Intent
The operator must be able to switch among all six Hypervisor views by pressing a single numeric key without using the mouse. Keys `"1"` through `"6"` are mapped one-to-one to the six `view_mode` atoms. Each key press updates the socket assign, persists the selection to localStorage, and triggers a re-render of the target view component. This covers all six valid keys and the negative case of an out-of-range key.

## Primary Actor
Operator

## Supporting Actors
- DashboardLive socket
- `phx-window-keydown` event binding (or equivalent client hook)
- localStorage hook
- FleetCommandComponents, SessionClusterComponents, RegistryComponents, SchedulerComponents, ForensicComponents, GodModeComponents

## Preconditions
- DashboardLive is mounted and connected via WebSocket.
- The operator has keyboard focus on the page (no modal or text input capturing keydown events).
- `view_mode` is currently any valid atom.

## Trigger
The operator presses one of the keys `"1"`, `"2"`, `"3"`, `"4"`, `"5"`, or `"6"` on the keyboard.

## Main Success Flow
1. The browser fires a `keydown` event captured by the `phx-window-keydown` binding or equivalent hook.
2. The event is pushed to `DashboardLive` as `handle_event("keydown", %{"key" => "3"}, socket)` (example: key `"3"`).
3. The handler matches key `"3"` and sets `view_mode: :registry`.
4. The handler calls the localStorage persistence helper, writing `"registry"` to localStorage key `view_mode`.
5. The socket is updated with `assign(socket, :view_mode, :registry)`.
6. The LiveView re-renders, delegating to `RegistryComponents.registry_view(assigns)`.
7. The operator sees the Registry view.

## Alternate Flows
### A1: Key "1" pressed — Fleet Command
Condition: Operator presses `"1"`.
Steps:
1. `handle_event` matches `"1"` → `view_mode: :fleet_command`.
2. localStorage writes `"fleet_command"`.
3. `FleetCommandComponents` renders.

### A2: Key "2" pressed — Session Cluster
Condition: Operator presses `"2"`.
Steps:
1. `handle_event` matches `"2"` → `view_mode: :session_cluster`.
2. localStorage writes `"session_cluster"`.
3. `SessionClusterComponents` renders.

### A3: Key "4" pressed — Scheduler
Condition: Operator presses `"4"`.
Steps:
1. `handle_event` matches `"4"` → `view_mode: :scheduler`.
2. localStorage writes `"scheduler"`.
3. `SchedulerComponents` renders.

### A4: Key "5" pressed — Forensic Inspector
Condition: Operator presses `"5"`.
Steps:
1. `handle_event` matches `"5"` → `view_mode: :forensic`.
2. localStorage writes `"forensic"`.
3. `ForensicComponents` renders.

### A5: Key "6" pressed — God Mode
Condition: Operator presses `"6"`.
Steps:
1. `handle_event` matches `"6"` → `view_mode: :god_mode`.
2. localStorage writes `"god_mode"`.
3. `GodModeComponents` renders.

## Failure Flows
### F1: Out-of-range key pressed
Condition: Operator presses `"7"` or any other non-mapped key.
Steps:
1. The `keydown` handler receives `%{"key" => "7"}`.
2. No match clause fires for `"7"`.
3. The catch-all clause (or absence of a matching clause) leaves `view_mode` unchanged.
Result: Current view remains active; no socket update occurs; no error is logged.

### F2: Key pressed while text input has focus
Condition: Operator is typing in a search box or text field and presses `"3"`.
Steps:
1. The text input captures the keydown event before the window-level binding.
2. The `phx-window-keydown` handler is not triggered (or the handler checks the event target).
Result: The text field receives the character; `view_mode` is not changed; no re-render occurs.

## Gherkin Scenarios

### S1: Key "3" navigates to Registry view
```gherkin
Scenario: Pressing key 3 switches to the Registry view
  Given the DashboardLive socket has view_mode assigned as :fleet_command
  When the operator presses key "3" triggering a keydown event on the window
  Then the socket assign "view_mode" equals ":registry"
  And localStorage key "view_mode" equals "registry"
  And the rendered HTML contains the registry-view container element
```

### S2: Key "7" produces no view change
```gherkin
Scenario: Pressing key 7 does not change view_mode
  Given the DashboardLive socket has view_mode assigned as :forensic
  When the operator presses key "7" triggering a keydown event on the window
  Then the socket assign "view_mode" remains ":forensic"
  And no socket update is pushed to the client
```

## Acceptance Criteria
- [ ] `mix test test/observatory_web/live/dashboard_live_test.exs` passes a test that simulates `keydown` events for keys `"1"` through `"6"` and asserts the socket `view_mode` transitions to `:fleet_command`, `:session_cluster`, `:registry`, `:scheduler`, `:forensic`, and `:god_mode` respectively.
- [ ] `mix test test/observatory_web/live/dashboard_live_test.exs` passes a test that simulates a `keydown` event for key `"7"` and asserts `view_mode` is unchanged.
- [ ] `mix compile --warnings-as-errors` passes.

## Data
**Inputs:** Keyboard `keydown` event with key value `"1"`–`"6"`
**Outputs:** Updated `view_mode` socket assign, localStorage write, re-rendered view component
**State changes:** `socket.assigns.view_mode` updated to the target atom; localStorage `view_mode` key updated to the string representation of the target atom.

## Traceability
- Parent FR: FR-12.2
- ADR: [ADR-022](../../decisions/ADR-022-six-view-ui-architecture.md)
