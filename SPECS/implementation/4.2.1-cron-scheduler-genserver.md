---
type: task
id: "4.2.1"
section_id: "4.2"
title: "CronScheduler GenServer Module"
status: pending
governed_by: ["ADR-019"]
parent_uc: ["UC-0264", "UC-0265"]
---

# Task 4.2.1: CronScheduler GenServer Module

## Goal

Create `lib/observatory/gateway/cron_scheduler.ex`. In `init/1`, query all `cron_jobs` rows and schedule timers for each unfinished job. Expose `schedule_once(agent_id, delay_ms, payload)` validating `delay_ms` is a positive integer, inserting a `CronJob` row, and registering a timer. When a timer fires, broadcast the payload and delete the row (for one-time jobs).

## Governing Decisions

- ADR-019

## Verification UCs

- UC-0264
- UC-0265

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 4.2.1.1 | Create cron_scheduler.ex with GenServer, startup recovery from cron_jobs table, and timer scheduling | mix compile --warnings-as-errors | pending |
| 4.2.1.2 | Implement schedule_once/3 with positive-integer validation, DB insert, and Process.send_after | mix compile --warnings-as-errors | pending |
| 4.2.1.3 | Implement handle_info({:fire_job}) with PubSub broadcast and row deletion for one-time jobs | mix compile --warnings-as-errors | pending |
| 4.2.1.4 | Add CronScheduler to application supervisor | mix compile --warnings-as-errors | pending |
