---
type: task
id: "4.3.3"
section_id: "4.3"
title: "HMAC-SHA256 Signature and Inbound Endpoint"
status: pending
governed_by: ["ADR-020"]
parent_uc: ["UC-0267"]
---

# Task 4.3.3: HMAC-SHA256 Signature and Inbound Endpoint

## Goal

Implement `POST /gateway/webhooks/:webhook_id` and the HMAC-SHA256 signature validation logic. Look up the `webhook_configs` row, compute the expected digest using `:crypto.mac(:hmac, :sha256, secret, payload_body)`, compare against `X-Observatory-Signature` header using `Plug.Crypto.secure_compare/2`, return HTTP 401 on mismatch with a `WebhookSignatureFailureEvent` broadcast.

## Governing Decisions

- ADR-020

## Verification UCs

- UC-0267

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 4.3.3.1 | Create webhook_controller.ex with receive/2 doing HMAC validation and 401 on mismatch | mix compile --warnings-as-errors | pending |
| 4.3.3.2 | Implement success path inserting WebhookDelivery row with status pending | mix compile --warnings-as-errors | pending |
| 4.3.3.3 | Add POST /gateway/webhooks/:webhook_id route and raw body reader config to router | mix compile --warnings-as-errors | pending |
| 4.3.3.4 | Add compute_outbound_signature/2 public function to WebhookRouter | mix compile --warnings-as-errors | pending |
