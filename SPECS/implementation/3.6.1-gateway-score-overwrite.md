---
type: task
id: "3.6.1"
section_id: "3.6"
title: "Gateway Authoritative Score Overwrite"
status: pending
governed_by: ["ADR-018", "ADR-015"]
parent_uc: ["UC-0246"]
---

# Task 3.6.1: Gateway Authoritative Score Overwrite

## Goal

`SchemaInterceptor` must call `EntropyTracker.record_and_score/2` synchronously after each successful schema validation and use the returned score to overwrite `cognition.entropy_score` in the outbound `DecisionLog` envelope via `DecisionLog.put_gateway_entropy_score/2`. If `record_and_score/2` returns an error, the original agent-reported score is retained and a warning log entry is emitted.

## Governing Decisions

- ADR-018
- ADR-015

## Verification UCs

- UC-0246

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 3.6.1.1 | Add EntropyTracker.record_and_score call synchronously in SchemaInterceptor post-validation path | mix compile --warnings-as-errors | pending |
| 3.6.1.2 | Pattern-match on result: {:ok, score} overwrites entropy_score; {:error} retains original with warning log | mix compile --warnings-as-errors | pending |
| 3.6.1.3 | Write integration tests for entropy overwrite and {:error, :missing_agent_id} retaining original score | mix test test/observatory/gateway/entropy_tracker_test.exs | pending |
