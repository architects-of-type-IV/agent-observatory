---
type: task
id: "5.2.2"
section_id: "5.2"
title: "PubSub Integration and Cost Heatmap Data Pipeline"
status: pending
governed_by: ["ADR-022"]
parent_uc: ["UC-0305"]
---

# Task 5.2.2: PubSub Integration and Cost Heatmap Data Pipeline

## Goal

Wire the `swarm:update` PubSub subscription to populate Fleet Command panel assigns in real time, and implement the cost heatmap data derivation from `state_delta.cumulative_session_cost` values in the DecisionLog stream. The heatmap must represent per-agent cost as a sorted list of `%{agent_id: string, cost: float}` maps.

## Governing Decisions

- ADR-022

## Verification UCs

- UC-0305

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 5.2.2.1 | Ensure handle_info({:swarm_update, payload}) extracts all five fleet command assigns with retain-existing fallback | mix compile --warnings-as-errors | pending |
| 5.2.2.2 | Confirm swarm:update subscription in mount/3 and implement build_cost_heatmap/1 helper grouping by agent_id | mix compile --warnings-as-errors | pending |
