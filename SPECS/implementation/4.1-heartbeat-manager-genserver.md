---
type: section
id: "4.1"
phase_id: "4"
title: "HeartbeatManager GenServer"
status: pending
---

# Section 4.1: HeartbeatManager GenServer

## Purpose

This section creates the `Observatory.Gateway.HeartbeatManager` GenServer, defines its public API (`record_heartbeat/2`), wires the 30-second self-check loop with a 90-second eviction threshold, creates the `gateway_heartbeats` SQLite table migration, and implements the `POST /gateway/heartbeat` HTTP endpoint. By the end of this section, agents can ping the gateway to register their liveness and stale agents are automatically removed.

## Tasks

| ID | Title | Governed By | Parent UCs | Status |
|----|-------|-------------|------------|--------|
| 4.1.1 | GenServer Module and State Map | ADR-019 | UC-0260, UC-0261 | pending |
| 4.1.2 | gateway_heartbeats Migration and Ecto Schema | ADR-019 | UC-0263 | pending |
| 4.1.3 | POST /gateway/heartbeat Controller | ADR-019 | UC-0260, UC-0262 | pending |
| 4.1.4 | HeartbeatManager Tests | ADR-019 | UC-0260, UC-0261, UC-0262, UC-0263 | pending |
