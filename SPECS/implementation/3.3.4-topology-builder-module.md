---
type: task
id: "3.3.4"
section_id: "3.3"
title: "TopologyBuilder Module"
status: pending
governed_by: ["ADR-016", "ADR-017"]
parent_uc: ["UC-0241"]
---

# Task 3.3.4: TopologyBuilder Module

## Goal

`Observatory.Gateway.TopologyBuilder` subscribes to DAG update events, reads the full adjacency map from `CausalDAG.get_session_dag/1` for the affected session, derives node and edge descriptor lists, and broadcasts to `"gateway:topology"`. It must not maintain its own copy of DAG node data. When `get_session_dag/1` returns `{:error, :session_not_found}`, it must skip silently.

## Governing Decisions

- ADR-016
- ADR-017

## Verification UCs

- UC-0241

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 3.3.4.1 | Create topology_builder.ex with GenServer subscribing to dag:updates meta-topic | mix compile --warnings-as-errors | pending |
| 3.3.4.2 | Implement handle_info deriving nodes/edges from DAG map and broadcasting to gateway:topology | mix compile --warnings-as-errors | pending |
| 3.3.4.3 | Update CausalDAG broadcast_delta to also publish session_dag_updated to dag:updates meta-topic | mix compile --warnings-as-errors | pending |
| 3.3.4.4 | Write tests for TopologyBuilder broadcasting after DAG delta and skipping pruned session | mix test test/observatory/gateway/topology_builder_test.exs | pending |
