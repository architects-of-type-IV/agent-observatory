---
type: task
id: "4.4.4"
section_id: "4.4"
title: "HITLRelay State Machine Tests"
status: pending
governed_by: ["ADR-021"]
parent_uc: ["UC-0271", "UC-0272", "UC-0273", "UC-0274"]
---

# Task 4.4.4: HITLRelay State Machine Tests

## Goal

Write ExUnit tests covering the state machine transitions, ETS buffer operations, rewrite-then-flush order, and edge cases.

## Governing Decisions

- ADR-021

## Verification UCs

- UC-0271
- UC-0272
- UC-0273
- UC-0274

## Subtasks

| ID | Title | Done When | Status |
|----|-------|-----------|--------|
| 4.4.4.1 | Write tests for pause returning :ok with HITLGateOpenEvent, double-pause returning :already_paused, unpause broadcasting HITLGateCloseEvent | mix test test/observatory/gateway/hitl_relay_test.exs | pending |
| 4.4.4.2 | Write tests for three buffered logs flushed in order, rewrite modifying buffered entry, non-existent trace_id error, and empty-buffer unpause | mix test test/observatory/gateway/hitl_relay_test.exs | pending |
