---
id: "1.1.1.6"
title: "Define embeds_one :state_delta and :control inner schemas"
status: pending
task_id: "1.1.1"
governed_by: ["ADR-014"]
parent_uc: ["UC-0200", "UC-0201"]
---

goal: "Add embeds_one :state_delta (added_to_memory, tokens_consumed, cumulative_session_cost) and embeds_one :control (hitl_required, interrupt_signal, is_terminal) inner schemas"
allowed_files:
  - lib/observatory/mesh/decision_log.ex
blocked_by: ["1.1.1.5"]
steps:
  - Add embeds_one :state_delta, StateDelta, primary_key: false with fields: added_to_memory {:array, :string}, tokens_consumed :integer, cumulative_session_cost :float
  - Add embeds_one :control, Control, primary_key: false with field :hitl_required, :boolean, default: false
  - Add field :interrupt_signal, :string and field :is_terminal, :boolean, default: false to Control
  - Confirm mix compile --warnings-as-errors passes with all six embedded schemas defined
done_when: "mix compile --warnings-as-errors"
